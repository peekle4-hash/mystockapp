*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple SD Gothic Neo','Noto Sans KR',sans-serif;margin:0;background:#f6f7fb;color:#111}
header{padding:18px 18px 12px;background:#0f172a;color:#fff}
h1{margin:0 0 6px 0;font-size:20px}
.sub{margin:0;color:#cbd5e1;font-size:13px}
main{max-width:1240px;margin:18px auto;padding:0 14px;display:flex;flex-direction:column;gap:14px}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:14px}
.card.small{padding:10px}
.row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.grow{flex:1}
.btns{display:flex;gap:8px;flex-wrap:wrap}
button,.file{border:1px solid #d1d5db;background:#111827;color:#fff;border-radius:10px;padding:9px 10px;font-weight:800;cursor:pointer}
button.secondary,.file.secondary{background:#fff;color:#111827}
button.danger{background:#b91c1c;border-color:#b91c1c}
button:hover,.file:hover{filter:brightness(1.06)}
button.secondary:hover,.file.secondary:hover{background:#f8fafc}
button.danger:hover{filter:brightness(1.08)}
.file{position:relative;overflow:hidden;display:inline-flex;align-items:center;gap:8px}
.file input{position:absolute;inset:0;opacity:0;cursor:pointer}
label{display:block;font-size:12px;color:#334155;margin-bottom:6px}
input[type="date"],input[type="text"],input[type="number"],select{border:1px solid #d1d5db;border-radius:10px;padding:9px 10px;font-size:14px}
input[type="number"]{width:120px}
select{padding:9px 10px}
.hint{color:#64748b;font-size:12px;margin-left:6px}
.note{margin-top:10px;color:#64748b;font-size:12px}

.table-wrap{overflow:auto;border:1px solid #e5e7eb;border-radius:10px}
.table-wrap.mini table{min-width:980px}
.table-wrap.data-entry{max-height:420px;overflow:auto}
@media (max-width:900px){
  .table-wrap.data-entry{max-height:320px}
  .table-wrap.mini table{min-width:900px}
  .table-wrap.data-entry th,
  .table-wrap.data-entry td{padding:4px 4px}
  .table-wrap.data-entry input[type="date"],
  .table-wrap.data-entry input[type="text"],
  .table-wrap.data-entry input[type="number"],
  .table-wrap.data-entry select{padding:3px 4px;font-size:11px}
  .row-actions{flex-direction:row;flex-wrap:nowrap;gap:3px}
  .row-actions button{padding:3px 6px;font-size:10px}
}

table{border-collapse:collapse;width:100%;min-width:1180px}
th,td{border-bottom:1px solid #e5e7eb;padding:10px 8px;text-align:center;font-size:13px;white-space:nowrap}
th{background:#f1f5f9;color:#0f172a;position:sticky;top:0;z-index:1}
tbody tr:hover{background:#fafafa}

.kpi-grid{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:10px;margin-top:12px}
@media (max-width:1100px){.kpi-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media (max-width:900px){.kpi-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}

.kpi{border:1px solid #e5e7eb;border-radius:12px;padding:10px;position:relative;box-shadow:0 1px 0 rgba(15,23,42,0.03),0 6px 18px rgba(15,23,42,0.06)}
.kpi::before{content:"";position:absolute;left:0;right:0;top:0;height:4px;border-top-left-radius:12px;border-top-right-radius:12px;background:#e5e7eb}
.kpi-all{background:#fff7e6}
.kpi-isa{background:#eef6ff}
.kpi-gen{background:#fff2f2}
.kpi-all::before{background:#f59e0b}
.kpi-isa::before{background:#3b82f6}
.kpi-gen::before{background:#ef4444}
.kpi-title{font-size:12px;color:#64748b;margin-bottom:6px;font-weight:800}
.kpi-val{font-size:18px;font-weight:900}
.kpi-val.pos{color:#16a34a}
.kpi-val.neg{color:#dc2626}
.kpi-val.zero{color:#64748b}

.h3{margin:0;font-size:14px}
.summary-row{margin-top:6px}
.seg{display:inline-flex;border:1px solid #d1d5db;border-radius:12px;overflow:hidden;margin-left:8px}
.seg-btn{border:0;background:#fff;color:#111827;padding:8px 10px;font-weight:800;cursor:pointer}
.seg-btn.active{background:#111827;color:#fff}
.seg-btn:hover{background:#f1f5f9}
.seg-btn.active:hover{filter:brightness(1.06)}

/* 모바일(특히 iOS)에서 클릭/포커스 시 색이 하얗게 뒤집히는 현상 방지 */
.seg .seg-btn{appearance:none;-webkit-appearance:none}
.seg .seg-btn:focus{outline:none}
.seg .seg-btn:active{background:#f1f5f9;color:#111827}
.seg .seg-btn.active:active{background:#111827;color:#fff}
/* ===== 탭 UI ===== */
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.tab-btn{border:1px solid rgba(255,255,255,0.22);background:rgba(255,255,255,0.08);color:#fff;border-radius:999px;padding:8px 12px;font-weight:900;cursor:pointer}
.tab-btn:hover{background:rgba(255,255,255,0.18)}
.tab-btn.active{background:#fff;color:#0f172a;border-color:#fff}
.tab-btn.active:hover{filter:brightness(0.98)}

.tab-page{display:none}
.tab-page.active{display:block}

/* sync layout */
.grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media (max-width:900px){.grid-2{grid-template-columns:1fr}}
.switch{display:inline-flex;align-items:center;gap:10px;color:#334155;font-size:13px;font-weight:800}
.switch input{width:18px;height:18px}
.ol{margin:8px 0 0 18px;color:#334155}

.charts{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:12px}
@media (max-width:900px){.charts{grid-template-columns:1fr}}
.chart{border:1px solid #e5e7eb;border-radius:12px;padding:10px;overflow:hidden}
.chart canvas{width:100%!important;height:320px!important}
@media (max-width:900px){.chart canvas{height:280px!important}}

footer{padding:16px 18px;color:#64748b;font-size:12px;text-align:center}
.small summary{cursor:pointer;font-weight:800}

/* 날짜별 접기/펼치기 */
tr.date-group-row td{background:#111827!important;color:#fff;font-weight:900;text-align:left}
.date-group{display:flex;align-items:center;gap:10px}
.date-pill{background:rgba(255,255,255,0.14);padding:4px 10px;border-radius:999px;font-size:12px}
.toggle-btn{border:1px solid rgba(255,255,255,0.35);background:transparent;color:#fff;border-radius:999px;padding:4px 10px;font-weight:900;cursor:pointer}
tr.group-hidden{display:none}
.group-totals{display:flex;gap:10px;flex-wrap:wrap;margin-left:auto;font-size:12px;opacity:.95}
.group-totals span{background:rgba(255,255,255,0.12);padding:4px 10px;border-radius:999px}

/* 행 액션 */
.row-actions{display:flex;gap:6px;justify-content:center;align-items:center;flex-wrap:nowrap}
.row-actions-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px}
.row-actions button{padding:6px 8px;border-radius:10px;font-weight:900;font-size:12px}
.row-actions button.secondary{background:#fff;color:#111827;border:1px solid #d1d5db}
.row-actions button.mini-danger{background:#b91c1c;border-color:#b91c1c;color:#fff}

/* 월별 표 구분 */
#monthlyTable th:nth-child(n+2):nth-child(-n+4),
#monthlyTable td:nth-child(n+2):nth-child(-n+4){background:#eef6ff}  /* ISA */
#monthlyTable th:nth-child(n+5):nth-child(-n+7),
#monthlyTable td:nth-child(n+5):nth-child(-n+7){background:#fff2f2}  /* 일반 */
#monthlyTable th:nth-child(n+8):nth-child(-n+10),
#monthlyTable td:nth-child(n+8):nth-child(-n+10){background:#fff7e6} /* 전체 */

/* 누적(마지막 3칸) */
#monthlyTable th:nth-child(11), #monthlyTable td:nth-child(11){background:#eef6ff}  /* ISA 누적 */
#monthlyTable th:nth-child(12), #monthlyTable td:nth-child(12){background:#fff2f2}  /* 일반 누적 */
#monthlyTable th:nth-child(13), #monthlyTable td:nth-child(13){background:#fff7e6}  /* 전체 누적 */

/* 그룹 구분선 */
#monthlyTable th:nth-child(2),  #monthlyTable td:nth-child(2),
#monthlyTable th:nth-child(5),  #monthlyTable td:nth-child(5),
#monthlyTable th:nth-child(8),  #monthlyTable td:nth-child(8),
#monthlyTable th:nth-child(11), #monthlyTable td:nth-child(11){border-left:2px solid #cbd5e1}

/* 헤더는 조금 더 진하게 */
#monthlyTable thead th:nth-child(n+2):nth-child(-n+4){background:#dbeafe}
#monthlyTable thead th:nth-child(n+5):nth-child(-n+7){background:#fee2e2}
#monthlyTable thead th:nth-child(n+8):nth-child(-n+10){background:#ffedd5}
#monthlyTable thead th:nth-child(11){background:#dbeafe}
#monthlyTable thead th:nth-child(12){background:#fee2e2}
#monthlyTable thead th:nth-child(13){background:#ffedd5}

/* ===== ISA/일반 KPI 4칸 그리드 ===== */
.kpi-grid-3{
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr)); /* 4칸 */
  gap:10px;
  margin-top:12px;
}
@media (max-width:900px){
  .kpi-grid-3{grid-template-columns:repeat(2,minmax(0,1fr))}
}

/* ===== 컴팩트 UI ===== */
.table-wrap.data-entry{
  margin-top: 32px;
  max-height:480px;
  overflow-y:auto;
  overflow-x:auto;
}

table{
  min-width:unset !important;
}

.table-wrap.data-entry table{
  min-width:800px;
}

th,td{
  padding:6px 6px;      /* 행 간격 줄임 */
  font-size:12px;
}

input[type="text"],
input[type="number"],
input[type="date"],
select{
  padding:5px 6px;
  font-size:12px;
  width:100%;
  min-width:60px;
}

.row-actions button{
  padding:4px 6px;
  font-size:11px;
}

@media (max-width:1200px){
  table{min-width:unset !important;}
}

/* 종가 일괄 입력 */
.bulk-box{width:100%}
textarea{width:100%;border:1px solid #d1d5db;border-radius:10px;padding:10px;font-size:13px;resize:vertical}
#closeTable{min-width:420px}
#closeTable input[type="number"]{width:160px}


/* ===== Segment Button Fix ===== */

/* 기본 상태 */
.segment-btn {
  background-color: #f2f2f2;
  color: #111;
  border: 1px solid #ddd;
  transition: none;
}

/* 마우스 올려도 색 유지 */
.segment-btn:hover {
  background-color: #f2f2f2;
  color: #111;
}

/* 선택된 상태 */
.segment-btn.active {
  background-color: #111;
  color: #fff;
  border-color: #111;
}

/* 클릭/포커스 시 색 깨짐 방지 */
.segment-btn:active,
.segment-btn:focus {
  background-color: inherit;
  color: inherit;
  outline: none;
}


/* ===== Segmented Filter Button Hover Fix (전체/ISA/일반) =====
   요구사항: 커서 올려도(hover) 색이 바뀌지 않게 고정
*/
.seg-btn:hover{
  background:#fff !important;
  color:#111827 !important;
  filter:none !important;
}
.seg-btn.active:hover{
  background:#111827 !important;
  color:#fff !important;
  filter:none !important;
}
/* 클릭(active)/포커스도 색 깨짐 방지 */
.seg .seg-btn:active{
  background:#fff !important;
  color:#111827 !important;
}
.seg .seg-btn.active:active{
  background:#111827 !important;
  color:#fff !important;
}


/* ===== Cloud UI additions ===== */
.note.ok { border-color: rgba(34,197,94,.35); }
.note.err { border-color: rgba(239,68,68,.35); }
.btn-like{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,.08);
  background:#fff;
  cursor:pointer;
  user-select:none;
  font-weight:600;
}
.btn-like:hover{ background:#f6f6f6; }


/* ===== PWA / 모바일 최적화 ===== */

/* 노치/홈바 영역 대응 */
body {
  padding-bottom: env(safe-area-inset-bottom);
}
header {
  padding-top: max(18px, env(safe-area-inset-top));
  padding-left: max(18px, env(safe-area-inset-left));
  padding-right: max(18px, env(safe-area-inset-right));
  position: sticky;
  top: 0;
  z-index: 100;
}

/* Standalone(앱) 모드에서 상태바 영역 추가 */
@media (display-mode: standalone) {
  header {
    padding-top: max(22px, env(safe-area-inset-top));
  }
}

/* 모바일 탭 버튼 스크롤 가능하게 */
@media (max-width: 600px) {
  .tabs {
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding-bottom: 4px;
    gap: 6px;
  }
  .tabs::-webkit-scrollbar { display: none; }
  .tab-btn {
    flex-shrink: 0;
    padding: 7px 10px;
    font-size: 13px;
  }

  /* 모바일 KPI 카드 더 compact하게 */
  .kpi-val { font-size: 15px; }
  .kpi-title { font-size: 11px; }

  /* 헤더 */
  h1 { font-size: 17px; }
  .sub { font-size: 11px; }

  /* main 여백 줄이기 */
  main { margin: 10px auto; padding: 0 8px; gap: 10px; }
  .card { padding: 10px; border-radius: 10px; }

  footer { padding-bottom: max(16px, env(safe-area-inset-bottom)); }
}


/* ============================================================
   로그인 화면
   ============================================================ */
#login-screen {
  min-height: 100dvh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 60%, #0f172a 100%);
  padding: 24px 16px;
  padding-top: max(24px, env(safe-area-inset-top));
}
.login-card {
  background: #fff;
  border-radius: 20px;
  padding: 36px 32px 28px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.4);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0;
}
.login-logo {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 10px;
}
.login-title {
  font-size: 22px;
  font-weight: 900;
  color: #0f172a;
  letter-spacing: -0.5px;
}
.login-sub {
  color: #64748b;
  font-size: 14px;
  text-align: center;
  margin: 0 0 24px;
  line-height: 1.6;
}
.btn-google {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: #fff;
  color: #111;
  border: 1.5px solid #d1d5db;
  border-radius: 12px;
  padding: 13px 16px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: background .15s, box-shadow .15s;
}
.btn-google:hover { background: #f8fafc; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }

.login-divider {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 18px 0;
  color: #94a3b8;
  font-size: 12px;
}
.login-divider::before, .login-divider::after {
  content: ''; flex: 1; height: 1px; background: #e5e7eb;
}

.email-form {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.email-form input {
  width: 100%;
  border: 1.5px solid #d1d5db;
  border-radius: 10px;
  padding: 12px 14px;
  font-size: 14px;
  transition: border-color .15s;
}
.email-form input:focus { outline: none; border-color: #3b82f6; }
.email-btns {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 2px;
}
.btn-primary {
  background: #0f172a;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 12px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: background .15s;
}
.btn-primary:hover { background: #1e293b; }
.btn-secondary {
  background: #f1f5f9;
  color: #0f172a;
  border: none;
  border-radius: 10px;
  padding: 12px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
}
.btn-secondary:hover { background: #e2e8f0; }
.btn-link {
  background: none;
  border: none;
  color: #94a3b8;
  font-size: 12px;
  cursor: pointer;
  margin-top: 16px;
  padding: 4px 8px;
  border-radius: 6px;
}
.btn-link:hover { color: #64748b; background: #f1f5f9; }

.login-msg {
  font-size: 13px;
  text-align: center;
  min-height: 18px;
  margin: 4px 0 0;
}
#login-buttons { width: 100%; }

/* ============================================================
   설정 모달
   ============================================================ */
.modal-overlay {
  position: fixed; inset: 0; z-index: 9000;
  background: rgba(15,23,42,0.7);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
}
.modal-box {
  background: #fff;
  border-radius: 16px;
  padding: 28px 24px;
  width: 100%;
  max-width: 520px;
  max-height: 90dvh;
  overflow-y: auto;
  box-shadow: 0 24px 64px rgba(0,0,0,0.3);
}
.modal-box h2 { margin: 0 0 6px; font-size: 20px; }
.modal-desc { color: #64748b; font-size: 13px; margin: 0 0 16px; }
.modal-box label { display: block; font-size: 12px; color: #334155; font-weight: 600; margin-bottom: 4px; }
.modal-box input[type="text"] {
  width: 100%; border: 1.5px solid #d1d5db; border-radius: 8px;
  padding: 10px 12px; font-size: 13px; font-family: monospace;
}
.modal-actions { display: flex; gap: 8px; margin-top: 16px; }
.modal-actions .btn-primary { flex: 1; }

.setup-guide { margin-top: 20px; }
.setup-guide summary { cursor: pointer; font-weight: 700; font-size: 13px; color: #475569; }
.setup-guide ol { font-size: 13px; color: #334155; line-height: 1.8; padding-left: 18px; margin: 10px 0; }
.setup-guide a { color: #3b82f6; }
.sql-block {
  background: #0f172a; color: #e2e8f0;
  border-radius: 8px; padding: 12px 14px;
  font-size: 11px; font-family: monospace;
  overflow-x: auto; white-space: pre;
  margin: 8px 0; line-height: 1.6;
}

/* ============================================================
   헤더 유저 영역 + 동기화 바
   ============================================================ */
.header-top {
  display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;
}
.header-user {
  display: flex; align-items: center; gap: 10px; flex-shrink: 0; margin-top: 2px;
}
.user-email {
  font-size: 12px; color: #94a3b8; max-width: 160px;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.btn-logout {
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.25);
  color: #fff; border-radius: 8px;
  padding: 6px 12px; font-size: 12px; font-weight: 700; cursor: pointer;
}
.btn-logout:hover { background: rgba(255,255,255,0.18); }

.sync-bar {
  padding: 5px 0 8px;
  font-size: 11px; font-weight: 600;
  transition: color .3s;
}
.sync-idle    { color: #94a3b8; }
.sync-syncing { color: #60a5fa; }
.sync-ok      { color: #4ade80; }
.sync-err     { color: #f87171; }

/* ============================================================
   PWA / 모바일 최적화
   ============================================================ */
body { padding-bottom: env(safe-area-inset-bottom); }
header {
  padding-top: max(18px, env(safe-area-inset-top));
  padding-left: max(18px, env(safe-area-inset-left));
  padding-right: max(18px, env(safe-area-inset-right));
  position: sticky; top: 0; z-index: 100;
}
@media (display-mode: standalone) {
  header { padding-top: max(22px, env(safe-area-inset-top)); }
}
@media (max-width: 600px) {
  .tabs { flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; padding-bottom: 4px; gap: 6px; }
  .tabs::-webkit-scrollbar { display: none; }
  .tab-btn { flex-shrink: 0; padding: 7px 10px; font-size: 13px; }
  .kpi-val { font-size: 15px; }
  .kpi-title { font-size: 11px; }
  h1 { font-size: 16px; }
  .sub { font-size: 11px; }
  main { margin: 10px auto; padding: 0 8px; gap: 10px; }
  .card { padding: 10px; border-radius: 10px; }
  .user-email { display: none; }
  footer { padding-bottom: max(16px, env(safe-area-inset-bottom)); }
  .login-card { padding: 28px 20px 22px; }
}
